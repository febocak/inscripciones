{"version":3,"sources":["src/app/util/backup/backup.component.html","src/app/util/backup/backup.component.ts","src/app/util/backup/backup.module.ts"],"names":[],"mappings":"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","sourcesContent":["export default \"<div class=\\\"row\\\">\\n  <div class=\\\"col-sm-12 col-md-8 col-lg-6 mx-auto\\\">\\n\\n    <div class=\\\"card mt-3\\\">\\n      <div class=\\\"card-header\\\">\\n        Respaldar datos\\n\\n      </div>\\n\\n      <div class=\\\"card-body\\\">\\n\\n        <div class=\\\"row\\\">\\n          <div class=\\\"col-12\\\">\\n            <h4> {{ mensaje }} </h4>\\n          </div>\\n          <div class=\\\"col-6\\\">\\n            <button class=\\\"btn btn-lg btn-block btn-primary\\\" [disabled]=\\\"preparacionStatus > 0\\\"\\n              (click)=\\\"generateDownloadJsonUri()\\\">\\n              Procesar\\n            </button>\\n          </div>\\n          <div class=\\\"col-6\\\">\\n            <button class=\\\"btn btn-lg btn-block btn-primary\\\" [disabled]=\\\"preparacionStatus < 2\\\"\\n              (click)=\\\"exportarDatos()\\\">\\n              Exportar\\n            </button>\\n          </div>\\n        </div>\\n\\n        <div class=\\\"row mt-3\\\">\\n          <div class=\\\"col-6 mx-auto\\\">\\n            <button class=\\\"btn btn-block btn-secondary\\\" (click)=\\\"goBack()\\\">\\n              Cancelar\\n            </button>\\n          </div>\\n        </div>\\n\\n        <a #aDownload class=\\\"btn btn-clear d-none\\\" title=\\\"Download JSON\\\" [href]=\\\"downloadJsonHref\\\" download=\\\"FeBoCaK.json\\\">\\n          Link\\n        </a> \\n\\n      </div>\\n    </div>\\n\\n  </div>\\n</div>\"","import { Component, OnInit, ElementRef, EventEmitter, Input, ViewChild, Output } from '@angular/core';\nimport { Location } from '@angular/common';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { CompetenciaI } from '@models/competencia';\nimport { CrudService } from '@services/crud.service';\nimport { merge } from 'rxjs';\nimport { first } from 'rxjs/operators';\n\n@Component({\n  selector: 'app-backup',\n  templateUrl: './backup.component.html',\n  styles: []\n})\nexport class BackupComponent implements OnInit {\n  @Input() competencia: CompetenciaI;\n  @ViewChild('aDownload', {static: false}) aDownload: ElementRef;\n  @Output() emitExportar = new EventEmitter<string>();\n\n  downloadJsonHref;\n  preparacionStatus = 0;\n  mensaje = 'El proceso de exportar los datos puede tardar varios minutos. Para iniciar pulse en el botón preparar datos. Una vez finalizado el proceso pulse en el botón exportar';\n  \n  constructor(\n    private location: Location,\n    private sanitizer: DomSanitizer,\n    private crudService: CrudService) { }\n\n  ngOnInit() {\n  }\n\n  goBack() {\n    this.location.back();\n  }\n\n  exportarDatos(){\n    this.aDownload.nativeElement.click();\n    this.emitExportar.emit('Exportar');\n    this.location.back();\n  }\n\n  generateDownloadJsonUri() {\n    this.mensaje = 'P r e p a r a n d o . . .';\n    this.preparacionStatus = 1;\n    let jsonData = '{';\n    let contador = 0;\n    let nomTablas =  ['categorias', 'clubes', 'distancias', 'competencias', 'consola', 'inscripciones', 'palistas', 'users'];\n    let arrObs = [];\n\n    nomTablas.forEach( tabla => arrObs.push(this.crudService.getAllRecords$(tabla)) );\n\n    /* console.log(this.competencia);\n    const competencias$ = this.crudService.getAllRecords$('').pipe(\n      map( data => data.filter( elemento => elemento.club === this.competencia.club &&\n                                elemento.competencia === this.competencia.competencia &&\n                                elemento.desde === this.competencia.desde &&\n                                elemento.hasta === this.competencia.hasta))\n    ); */\n\n    const result$ = merge(...arrObs);\n    result$.subscribe({\n      next: data => {\n        jsonData = jsonData +  '\"' + nomTablas[contador] + '\":' + JSON.stringify(data);\n        contador++;\n        if (contador < nomTablas.length) {\n          jsonData = jsonData + ',';\n        }\n      },\n      complete: () => {\n        jsonData = jsonData + '}';\n          this.downloadJsonHref = this.sanitizer.bypassSecurityTrustUrl(\"data:text/json;charset=UTF-8,\" + encodeURIComponent(jsonData));\n          this.mensaje = 'Preparación finalizada';\n          this.preparacionStatus = 2;\n      }\n    });\n\n  }\n}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { BackupComponent } from './backup.component';\r\n\r\nconst routes: Routes = [\r\n  { path: '', component: BackupComponent }\r\n];\r\n@NgModule({\r\n  declarations: [BackupComponent],\r\n  imports: [ \r\n    CommonModule, \r\n    RouterModule.forChild(routes)\r\n  ]\r\n})\r\nexport class BackupModule { }"],"sourceRoot":"webpack:///"}