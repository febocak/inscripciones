{"version":3,"sources":["./src/app/util/backup/backup.component.html","./src/app/util/backup/backup.component.ts","./src/app/util/backup/backup.module.ts"],"names":[],"mappings":"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","file":"util-backup-backup-module-es2015.js","sourcesContent":["export default \"<div class=\\\"row\\\">\\n  <div class=\\\"col-sm-12 col-md-8 col-lg-6 mx-auto\\\">\\n\\n    <div class=\\\"card mt-3\\\">\\n      <div class=\\\"card-header\\\">\\n        Respaldar datos\\n\\n      </div>\\n\\n      <div class=\\\"card-body\\\">\\n\\n        <div class=\\\"row\\\">\\n          <div class=\\\"col-12\\\">\\n            <h4> {{ mensaje }} </h4>\\n          </div>\\n          <div class=\\\"col-6\\\">\\n            <button class=\\\"btn btn-lg btn-block btn-primary\\\" [disabled]=\\\"preparacionStatus > 0\\\"\\n              (click)=\\\"generateDownloadJsonUri()\\\">\\n              Procesar\\n            </button>\\n          </div>\\n          <div class=\\\"col-6\\\">\\n            <button class=\\\"btn btn-lg btn-block btn-primary\\\" [disabled]=\\\"preparacionStatus < 2\\\"\\n              (click)=\\\"exportarDatos()\\\">\\n              Exportar\\n            </button>\\n          </div>\\n        </div>\\n\\n        <div class=\\\"row mt-3\\\">\\n          <div class=\\\"col-6 mx-auto\\\">\\n            <button class=\\\"btn btn-block btn-secondary\\\" (click)=\\\"goBack()\\\">\\n              Cancelar\\n            </button>\\n          </div>\\n        </div>\\n\\n        <a #aDownload class=\\\"btn btn-clear d-none\\\" title=\\\"Download JSON\\\" [href]=\\\"downloadJsonHref\\\" download=\\\"FeBoCaK.json\\\">\\n          Link\\n        </a> \\n\\n      </div>\\n    </div>\\n\\n  </div>\\n</div>\"","import { Component, OnInit, ElementRef, EventEmitter, Input, ViewChild, Output } from '@angular/core';\nimport { Location } from '@angular/common';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { CompetenciaI } from '@models/competencia';\nimport { CrudService } from '@services/crud.service';\nimport { merge } from 'rxjs';\nimport { first } from 'rxjs/operators';\n\n@Component({\n  selector: 'app-backup',\n  templateUrl: './backup.component.html',\n  styles: []\n})\nexport class BackupComponent implements OnInit {\n  @Input() competencia: CompetenciaI;\n  @ViewChild('aDownload', {static: false}) aDownload: ElementRef;\n  @Output() emitExportar = new EventEmitter<string>();\n\n  downloadJsonHref;\n  preparacionStatus = 0;\n  mensaje = 'El proceso de exportar los datos puede tardar varios minutos. Para iniciar pulse en el botón preparar datos. Una vez finalizado el proceso pulse en el botón exportar';\n  \n  constructor(\n    private location: Location,\n    private sanitizer: DomSanitizer,\n    private crudService: CrudService) { }\n\n  ngOnInit() {\n  }\n\n  goBack() {\n    this.location.back();\n  }\n\n  exportarDatos(){\n    this.aDownload.nativeElement.click();\n    this.emitExportar.emit('Exportar');\n    this.location.back();\n  }\n\n  generateDownloadJsonUri() {\n    this.mensaje = 'P r e p a r a n d o . . .';\n    this.preparacionStatus = 1;\n    let jsonData = '{';\n    let contador = 0;\n    let nomTablas =  ['categorias', 'clubes', 'distancias', 'competencias', 'consola', 'inscripciones', 'palistas', 'users'];\n    let arrObs = [];\n\n    nomTablas.forEach( tabla => arrObs.push(this.crudService.getAllRecords$(tabla)) );\n\n    /* console.log(this.competencia);\n    const competencias$ = this.crudService.getAllRecords$('').pipe(\n      map( data => data.filter( elemento => elemento.club === this.competencia.club &&\n                                elemento.competencia === this.competencia.competencia &&\n                                elemento.desde === this.competencia.desde &&\n                                elemento.hasta === this.competencia.hasta))\n    ); */\n\n    const result$ = merge(...arrObs);\n    result$.subscribe({\n      next: data => {\n        jsonData = jsonData +  '\"' + nomTablas[contador] + '\":' + JSON.stringify(data);\n        contador++;\n        if (contador < nomTablas.length) {\n          jsonData = jsonData + ',';\n        }\n      },\n      complete: () => {\n        jsonData = jsonData + '}';\n          this.downloadJsonHref = this.sanitizer.bypassSecurityTrustUrl(\"data:text/json;charset=UTF-8,\" + encodeURIComponent(jsonData));\n          this.mensaje = 'Preparación finalizada';\n          this.preparacionStatus = 2;\n      }\n    });\n\n  }\n}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { BackupComponent } from './backup.component';\r\n\r\nconst routes: Routes = [\r\n  { path: '', component: BackupComponent }\r\n];\r\n@NgModule({\r\n  declarations: [BackupComponent],\r\n  imports: [ \r\n    CommonModule, \r\n    RouterModule.forChild(routes)\r\n  ]\r\n})\r\nexport class BackupModule { }"],"sourceRoot":"webpack:///"}